rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // REGRA 1: PERFIL DO USUÁRIO (Específica e Crítica)
    // Permite que um usuário crie, leia e atualize seu próprio perfil.
    match /usuarios/{userId} {
      allow read, create, update: if request.auth != null && request.auth.uid == userId;
    }

    // REGRA 2: DADOS DA APLICAÇÃO (Leitura Geral)
    // Permite que qualquer usuário autenticado leia as coleções necessárias
    // para o funcionamento da aplicação.
    match /leads/{doc} { allow read: if request.auth != null; }
    match /propostas/{doc} { allow read: if request.auth != null; }
    match /estoque/{doc} { allow read: if request.auth != null; }
    match /movimentacoesEstoque/{doc} { allow read: if request.auth != null; }
    match /compras/{doc} { allow read: if request.auth != null; }
    match /vendas/{doc} { allow read: if request.auth != null; }
    match /clientes/{doc} { allow read: if request.auth != null; }
    match /visitas/{doc} { allow read: if request.auth != null; }
    match /servicos/{doc} { allow read: if request.auth != null; }
    match /custos/{doc} { allow read: if request.auth != null; }
    match /execucoes/{doc} { allow read: if request.auth != null; }
    match /pos-venda/{doc} { allow read: if request.auth != null; }
    match /sla_command/{doc} { allow read: if request.auth != null; }
    match /alerts/{doc} { allow read: if request.auth != null; }
    match /financeiro/{doc} { allow read: if request.auth != null; }
    match /logs/{doc} { allow read: if request.auth != null; }
    match /notificacoes/{doc} { allow read: if request.auth != null; }
    match /projetos/{doc} { allow read: if request.auth != null; }
    match /segmentos/{doc} { allow read: if request.auth != null; }
  }
}
